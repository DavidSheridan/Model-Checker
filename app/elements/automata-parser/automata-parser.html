<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../scripts/lexer.html">

<script>
  (function() {
    Polymer({
      is: 'automata-parser',

      properties: {

        /**
         * The code to be parsed
         */
         code: {
           type: String,
           value: ''
         },

         /**
          * The index we are up to
          * Used in the parsing process
          */
         _index: {
           type: Number,
           value: 0
         }
      },

      /**
       * Parse the code
       *
       * @return {array} a token array
       * @throws {this.SyntaxError} Code must be valid
       */
      parse: function(){
        var lexer = new Lexer(this.code);

        this._index = 0;
        var nodes = [];
        var edges = [];

        while(lexer.hasNext()){
          var token = lexer.next();
          if(token.type == 'LABEL'){

          }
        }
        //result.push(this._automataParseNode());
        //result.push(this._automataParseOperation());
        //result.push(this._automataParseNode());

        //return result;
      },

      /**
       * Parse a node
       *
       * @return {string} The node's name
       */
      _automataParseNode: function(){
        var initIndex = this._index;
        var reg = /[a-zA-Z][a-zA-Z0-9]*/g;
        var node, nextNode;
        while(reg.test(nextNode = this.code.substring(initIndex, this._index + 1))){
          node = nextNode;
          this._index++;
        }
        return node;
      },

      /**
       * Parse an operation
       *
       * @return {string} The operation
       */
      _automataParseOperation: function(){
        var op;
        if((op = '->') == this.code.substring(this._index, this._index+2)){
          this._index += op.length;
          return op;
        }
        throw new this.SyntaxError('Syntax Error at char '+this._index+': couldn\'t parse operation.');
      },

      /**
       * The Node class
       */
      _Node: function(label){
        this.label = label;
      },

      /**
       * The Edge class
       */
      _Edge: function(from, to, label){
        this.from = from;
        this.to = to;
        this.label = label;
      },

      /**
       * An object to be thrown
       */
      SyntaxError: function(msg){
        this.message = msg;
      },

      /**
       * Called when element is created
       */
      created: function(){
        /**
         * Create the methods for the _Node class
         */
        this._Node.prototype.foo = function(){
          return 'bar';
        }
      }

    });
  })();
</script>
