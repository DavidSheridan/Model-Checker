<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>lexer test</title>

  <script src="../../bower_components/webcomponentsjs/webcomponents.min.js"></script>
  <link rel="import" href="../../bower_components/polymer/polymer.html">
  <script src="../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../bower_components/test-fixture/test-fixture-mocha.js"></script>
  <link rel="import" href="../../bower_components/test-fixture/test-fixture.html">

</head>
<body>

  <script src="../scripts/lexer.js"></script>
  <script>

    suite('lexer tests', function() {

      test('valid alphabet', function() {
        var code = "= ( ) [ ] -> * + | || ? . test"
        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        var token = lexer.next();
        //should be parsing =
        assert.equal(token.type, "DEFINE");

        //should be parsing (
        token = lexer.next();
        assert.equal(token.type, "LBRACK");

        //should be parsing )
        token = lexer.next();
        assert.equal(token.type, "RBRACK");

        //should be parsing [
        token = lexer.next();
        assert.equal(token.type, "LSQBRACK");

        //should be parsing ]
        token = lexer.next();
        assert.equal(token.type, "RSQBRACK");

        //should be parsing ->
        token = lexer.next();
        assert.equal(token.type, "SEQUENCE");

        //should be parsing *
        token = lexer.next();
        assert.equal(token.type, "ZERO_MANY");

        //should be parsing +
        token = lexer.next();
        assert.equal(token.type, "ONE_MANY");

        //should be parsing |
        token = lexer.next();
        assert.equal(token.type, "CHOICE");

        //should be parsing ||
        token = lexer.next();
        assert.equal(token.type, "PARALLEL");

        //should be parsing ?
        token = lexer.next();
        assert.equal(token.type, "OPTIONAL");

        //should be parsing .
        token = lexer.next();
        assert.equal(token.type, "END");

        //should be parsing test
        token = lexer.next();
        assert.equal(token.type, "ACTION");

        //should be parsing end of code
        token = lexer.next();
        assert.equal(token.type, "ENDFILE");

      });

      test('valid constants test', function() {
        var code = "EOF unknown"
        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        var token = lexer.next();
        //should be parsing EOF which is interpreted as a label
        assert.equal(token.type, "ACTION");

        //should find we're at the unknown which is interpreted as a label
        token = lexer.next();
        assert.equal(token.type, "ACTION");
      });

      test('valid two label test', function() {
        var code = "a b"
        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        var token = lexer.next();
        //should be parsing a
        assert.equal(token.type, "ACTION");

        //should be parsing b
        token = lexer.next();
        assert.equal(token.type, "ACTION");

        //should find we're at the EOF
        token = lexer.next();
        assert.equal(token.type, "ENDFILE");
      });

      test('valid two label sequence test', function() {
        var code = "a -> b"
        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        var token = lexer.next();
        //should be parsing a
        assert.equal(token.type, "ACTION");

        //should be parsing ->
        token = lexer.next();
        assert.equal(token.type, "SEQUENCE");

        //should be parsing b
        token = lexer.next();
        assert.equal(token.type, "ACTION");

        //should find we're at the EOF
        token = lexer.next();
        assert.equal(token.type, "ENDFILE");
      });

      test('valid peek test', function() {
        var code = "a -> b "
        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        //should be peeking a
        var token = lexer.peek();
        assert.equal(token.type, "ACTION");
        assert.equal(token.text, "a");

        //should be parsing a
        lexer.next();

        //should be peeking ->
        token = lexer.peek();
        assert.equal(token.type, "SEQUENCE");
        assert.equal(token.text, "->");

        //should be parsing ->
        lexer.next();

        //should be peeking b
        token = lexer.peek();
        assert.equal(token.type, "ACTION");
        assert.equal(token.text, "b");

        //should be parsing b
        lexer.next();

        //should find we're at the EOF
        token = lexer.peek();
        assert.equal(token.type, "ENDFILE");
      });

      test('valid assignment test', function() {

        var code = "CLOCK = (tick->CLOCK)."

        var lexer = new Lexer(code);

        assert.equal(lexer.hasNext(), true);

        var token = lexer.next();
        //should be parsing CLOCK
        assert.equal(token.type, "ACTION");

        //should be parsing =
        token = lexer.next();
        assert.equal(token.type, "DEFINE");

        //should be parsing (
        token = lexer.next();
        assert.equal(token.type, "LBRACK");

        //should be parsing tick
        token = lexer.next();
        assert.equal(token.type, "ACTION");

        //should be parsing ->
        token = lexer.next();
        assert.equal(token.type, "SEQUENCE");

        //should be parsing CLOCK
        token = lexer.next();
        assert.equal(token.type, "ACTION");

        //should be parsing )
        token = lexer.next();
        assert.equal(token.type, "RBRACK");

        //should be parsing .
        token = lexer.next();
        assert.equal(token.type, "END");

        //should find we're at the EOF
        token = lexer.next();
        assert.equal(token.type, "ENDFILE");
      });

    });
  </script>

</body>
</html>
